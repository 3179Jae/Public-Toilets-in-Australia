<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dot Map, Bar Chart, Babychange Availability, Donut Chart, and Bubble Chart of Public Toilets in Australia</title>
    <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
    <style>
        #vis, #bar_chart, #babychange_chart, #donut_chart, #bubble_chart {
            margin: 20px 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .content-container {
            display: flex;
            flex-direction: row;
            align-items: center;
            justify-content: flex-start; /* 간격 줄이기 위해 수정 */
            margin: 10px 0;
            padding-left: 50px; /* 왼쪽 공백 추가 */
        }

        .text-content, .chart-container {
            width: 45%;
        }
        p {
            max-width: 60ch;
        }
    </style>
</head>
<body style="background-color: #e0f7fa;">
    <h1 style="text-align: center; font-size: 2.5em;">Public Toilets in Australia</h1>
    <div class="content-container">
        <div class="text-content">
            <p>This webpage provides a detailed visual analysis of public toilet facilities in Australia. The visualizations presented here are based on real-world data and are intended to offer insights into the distribution, accessibility, and availability of baby change facilities across different states in Australia. The aim is to support public health planning and provide useful information to the general public about the available facilities.</p>
        </div>
        <div class="chart-container">
            <div id="vis" style="width: 100%;"></div>
        </div>
    </div>

    <div class="content-container">
        <div class="text-content">
            <h2>Number of Public Toilets by State</h2>
            <p>This bar chart allows users to
            explore the number of public toilets
            in each state. Users can filter by
            whether a key is required to access
            the facility. This information can
            help assess the accessibility of
            public facilities across different
            regions.</p>
            <div>
                <button id="keyRequiredAllButton">Key Required: All</button>
                <button id="keyRequiredYesButton">Key Required: Yes</button>
                <button id="keyRequiredNoButton">Key Required: No</button>
                <script type="text/javascript">
                    // Add these corrected event listeners to ensure proper functionality of the key filters
                    document.getElementById('keyRequiredAllButton').addEventListener('click', function() {
                        renderChart('all');
                    });
                
                    document.getElementById('keyRequiredYesButton').addEventListener('click', function() {
                        renderChart('TRUE');
                    });
                
                    document.getElementById('keyRequiredNoButton').addEventListener('click', function() {
                        renderChart('FALSE');
                    });
                </script>
                
            </div>
        </div>
        <div id="bar_chart" class="chart-container"></div>
    </div>

    <div class="content-container" style="margin-left: 100px;">
        <div id="babychange_chart" class="chart-container"></div>
        <div class="text-content" style="margin-left: 150px">
            <h2>Facility Type and Babychange Availability</h2>
            <p>The chart below highlights the
            availability of baby change
            facilities by facility type. This
            information is particularly useful
            for parents and caregivers who need
            access to changing facilities when
            traveling with young children.</p>
        </div>
    </div>
    

    <div class="content-container">
        <div class="text-content">
            <h2>Donut Chart of Accessible Public Toilets by State</h2>
            <p>This donut chart provides a visual
            representation of the proportion of
            accessible public toilets by state.
            Users can filter by specific states
            to understand the accessibility of
            public toilets in a particular
            region.</p>
            <div>
                <label for="stateFilter">Select State:</label>
                <select id="stateFilter">
                    <option value="all">All</option>
                    <option value="ACT">ACT</option>
                    <option value="NSW">NSW</option>
                    <option value="NT">NT</option>
                    <option value="QLD">QLD</option>
                    <option value="SA">SA</option>
                    <option value="TAS">TAS</option>
                    <option value="VIC">VIC</option>
                    <option value="WA">WA</option>
                </select>
            </div>
        </div>
        <div id="donut_chart" class="chart-container"></div>
    </div>

    <div class="content-container">
        <div id="bubble_chart" class="chart-container"></div>
        <div class="text-content">
            <h2>Bubble Chart of Public Toilet Facilities by Type and State</h2>
            <p>The bubble chart below represents
            the distribution of public toilet
            facilities by type and state. Users
            can filter the facilities to see
            those with or without baby change
            facilities, providing a more detailed
            understanding of the types of
            amenities available across different
            regions.</p>
            <div>
                <label for="bubbleFilter">Show facilities with BabyChange:</label>
                <select id="bubbleFilter" onchange="updateBubbleChart()">
                    <option value="all">All</option>
                    <option value="true">BabyChange: TRUE</option>
                    <option value="false">BabyChange: FALSE</option>
                </select>
            </div>
        </div>
    </div>

    <script type="text/javascript">
        // Dot Map Specification
        const mapSpec = {
            "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
            "description": "A dot map showing the locations of public toilets in Australia.",
            "width": 1000,
            "height": 600,
            "data": {
                "url": "https://raw.githubusercontent.com/3179Jae/3179/refs/heads/main/Toilet_Clean1.csv",
                "format": { "type": "csv" }
            },
            "projection": {
                "type": "mercator"
            },
            "layer": [
                {
                    "mark": {
                        "type": "geoshape",
                        "fill": "white",
                        "stroke": "black", "strokeWidth": 2
                    },
                    "data": {
                        "url": "https://raw.githubusercontent.com/3179Jae/3179/refs/heads/main/ne_1.json",
                        "format": { "type": "topojson", "feature": "ne_110m_admin_0_countries" }
                    }
                },
                {
                    "data": {
                        "url": "https://raw.githubusercontent.com/3179Jae/3179/refs/heads/main/ne_110m33.json",
                        "format": { "type": "topojson", "featurecla":"Admin-1 states provinces" }
                    },
                    "mark": {
                        "type": "geoshape",
                        "fill": null,
                        "stroke": "lightgray",
                        "strokeWidth": 1
                    }
                },
                {
                    "mark": "circle",
                    "encoding": {
                        "longitude": { "field": "Longitude", "type": "quantitative" },
                        "latitude": { "field": "Latitude", "type": "quantitative" },
                        "size": {
                            "value": 10
                        },
                        "color": {
                            "value": "#1f77b4" }, // Blue color for dots
                        "tooltip": [
                            { "field": "Name", "type": "nominal", "title": "Name" },
                            { "field": "FacilityType", "type": "nominal", "title": "Type" },
                            { "field": "Address", "type": "nominal", "title": "Address" }
                        ]
                    }
                }
            ]
        };
        vegaEmbed('#vis', mapSpec).catch(console.error);

        // Bar Chart Specification
        function renderChart(keyRequired) {
            const barChartSpec = {
                "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
                "description": "A bar chart showing the number of public toilets by state, filtered by key requirement.",
                "width": 700,
                "height": 500,
                "data": {
                    "url": "https://raw.githubusercontent.com/3179Jae/3179/main/Toilet_Clean1.csv",
                    "format": {
                        "type": "csv"
                    }
                },
                "transform": keyRequired !== 'all' ? [
                    {
                        "filter": `datum.KeyRequired == '${keyRequired}'`
                    }
                ] : [],
                "mark": "bar",
                "encoding": {
                    "x": {
                        "field": "State",
                        "type": "nominal",
                        "axis": {"title": "State"}
                    },
                    "y": {
                        "aggregate": "count",
                        "type": "quantitative",
                        "axis": {"title": "Number of Toilets"},
                        "scale": {"domain": [0, 9000]}
                    },
                    "color": {
                        "field": "State",
                        "type": "nominal",
                        "scale": {"scheme": "category20"}, // Consistent color scheme for state
                        "legend": {"title": "State"}
                    }
                },
                "selection": {
                    "highlight": {
                        "type": "single",
                        "empty": "none",
                        "on": "mouseover"
                    }
                },
                "config": {
                    "mark": {
                        "tooltip": true,
                        "fillOpacity": 0.8,
                        "stroke": "black",
                        "strokeWidth": 1
                    }
                }
            };

            vegaEmbed('#bar_chart', barChartSpec).then(result => {
                // Access the Vega view instance if needed
            }).catch(console.error);
        }
        renderChart('all');

        // Babychange Availability Bar Chart Specification
        const babychangeSpec = {
            "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
            "description": "Bar chart showing babychange availability by facility type.",
            "data": {
                "url": "https://raw.githubusercontent.com/3179Jae/3179/refs/heads/main/Toilet_Clean1.csv",
                "format": {"type": "csv"}
            },
            "transform": [
                {
                    "aggregate": [{"op": "count", "as": "Number of Toilets"}],
                    "groupby": ["FacilityType", "Babychange"]
                }
            ],
            "mark": "bar",
            "encoding": {
                "x": {
                    "field": "FacilityType",
                    "type": "nominal",
                    "axis": {"title": "Facility Type", "labelAngle": -45}
                },
                "y": {
                    "field": "Number of Toilets",
                    "type": "quantitative",
                    "axis": {"title": "Number of Toilets"}
                },
                "color": {
                    "field": "Babychange",
                    "type": "nominal",
                    "scale": {"range": ["#2ca02c", "#ff7f0e"]}, // Distinct colors for babychange availability
                    "legend": {"title": "Babychange Availability"}
                }
            },
            "width": 600,
            "height": 400,
            "selection": {
                "highlight": {
                    "type": "single",
                    "empty": "none",
                    "on": "mouseover"
                }
            },
            "config": {
                "mark": {
                    "tooltip": true,
                    "fillOpacity": 0.8,
                    "stroke": "black",
                    "strokeWidth": 1
                }
            }
        };
        vegaEmbed('#babychange_chart', babychangeSpec).catch(console.error);

        // Donut Chart Specification
        function renderDonutChart(state) {
            const donutChartSpec = {
                "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
                "description": "A donut chart showing the proportion of accessible public toilets by state.",
                "width": 500,
                "height": 400,
                "data": {
                    "url": "https://raw.githubusercontent.com/3179Jae/3179/main/Toilet_Clean1.csv",
                    "format": {
                        "type": "csv"
                    }
                },
                "transform": [
                    {
                        "calculate": "datum.Accessible == 'TRUE' ? 'Accessible' : 'Not Accessible'",
                        "as": "Accessibility"
                    },
                    ...(state !== 'all' ? [{ "filter": `datum.State == '${state}'` }] : [])
                ],
                "mark": {
                    "type": "arc",
                    "innerRadius": 50
                },
                "encoding": {
                    "theta": {
                        "field": "count",
                        "aggregate": "count",
                        "type": "quantitative",
                        "title": "Number of Toilets"
                    },
                    "color": {
                        "field": "Accessibility",
                        "type": "nominal",
                        "scale": {"range": ["#d62728", "#9467bd"]}, // Distinct colors for accessibility
                        "legend": {
                            "title": "Accessibility"
                        }
                    },
                    "tooltip": [
                        { "field": "Accessibility", "type": "nominal", "title": "Accessibility" },
                        { "field": "count", "type": "quantitative", "aggregate": "count", "title": "Number of Toilets" },
                        { "field": "State", "type": "nominal", "title": "State" }
                    ]
                },
                "config": {
                    "view": {
                        "stroke": "transparent"
                    },
                    "arc": {
                        "cornerRadius": 5,
                        "padAngle": 0.02
                    }
                }
            };

            vegaEmbed('#donut_chart', donutChartSpec).catch(console.error);
        }
        renderDonutChart('all');

        // Bubble Chart Specification
        function updateBubbleChart() {
            var filterValue = document.getElementById("bubbleFilter").value;
            var filteredSpec = JSON.parse(JSON.stringify(bubbleSpec));

            if (filterValue === "true") {
                filteredSpec.transform = [{ "filter": "datum.BabyChange == 'TRUE'" }];
            } else if (filterValue === "false") {
                filteredSpec.transform = [{ "filter": "datum.BabyChange == 'FALSE'" }];
            }

            filteredSpec.transform.push({
                "aggregate": [
                    {
                        "op": "count",
                        "as": "facility_count"
                    }
                ],
                "groupby": ["FacilityType", "State"]
            });

            filteredSpec.selection = {
                "highlight": {
                    "type": "single",
                    "empty": "none",
                    "on": "mouseover"
                }
            };

            filteredSpec.config = {
                "mark": {
                    "tooltip": true,
                    "fillOpacity": 0.8,
                    "stroke": "black",
                    "strokeWidth": 1
                }
            };

            vegaEmbed('#bubble_chart', filteredSpec).catch(console.error);
        }

        const bubbleSpec = {
            "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
            "description": "Bubble chart representing the distribution of public toilet facilities by type and State.",
            "width": 500,
            "height": 400,
            "data": {
                "url": "https://raw.githubusercontent.com/3179Jae/3179/refs/heads/main/Toilet_Clean1.csv",
                "format": {
                    "type": "csv"
                }
            },
            "transform": [],
            "mark": {
                "type": "circle",
                "tooltip": true
            },
            "encoding": {
                "x": {
                    "field": "FacilityType",
                    "type": "nominal",
                    "axis": {
                        "title": "Facility Type"
                    }
                },
                "y": {
                    "field": "State",
                    "type": "nominal",
                    "axis": {
                        "title": "State"
                    }
                },
                "size": {
                    "field": "facility_count",
                    "type": "quantitative",
                    "title": "Number of Facilities"
                },
                "color": {
                    "field": "State",
                    "type": "nominal",
                    "scale": {"scheme": "category20"}, // Consistent color scheme for state
                    "title": "State"
                }
            },
            "config": {
                "view": {
                    "stroke": "transparent"
                },
                "axis": {
                    "labelFontSize": 12,
                    "titleFontSize": 14
                }
            }
        };
        updateBubbleChart();
    </script>
</body>
</html>